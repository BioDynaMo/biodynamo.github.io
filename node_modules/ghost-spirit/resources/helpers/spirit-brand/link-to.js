'use strict';

const hbs = require('express-hbs');
const urlForLocale = require('../middleware/i18n-path-handler').urlForLocale;

hbs.registerHelper('link-to', function (href, options) {
    if (href === undefined) {
        // console.error('TEMPLATE ERROR: link-to path must be a string in quotes');
        return;
    }

    let locale = options.data.root.locale;
    let localeHref = urlForLocale(href, locale);
    let attrs = Object.keys(options.hash).map(key => `${key}="${options.hash[key]}"`).join(' ');

    return new hbs.handlebars.SafeString(
        `<a href="${localeHref}" ${attrs}>`
        + options.fn(this)
        + '</a>'
    );
});
