{"componentChunkName":"component---src-templates-markdown-post-js","path":"/docs/userguide/diffusion/","webpackCompilationHash":"3d3ed4a2e32a0c71d021","result":{"data":{"site":{"siteMetadata":{"siteUrl":"http://local:8000","title":"BioDynaMO Website","description":"Everything you need to know about biology simulations."}},"markdownRemark":{"frontmatter":{"title":"Diffusion","date":"2019-01-01","date_pretty":"01 January, 2019","path":"/docs/userguide/diffusion/","meta_title":"BioDynaMo User Guide","meta_description":"This is the diffusion page.","image":"","next":{"url":"/docs/userguide/diffusion/","title":"Diffusion","description":"This is the diffusion page."},"sidebar":"userguide","toc":true},"html":"<p>One of BioDynaMo's built-in biological processes is extracellular diffusion.\nIt is the process of extracellular substances diffusing through space. The constants\nthat govern the diffusion process can be set by the user. Let's go through an\nexample where diffusion plays a role.</p>\n<h3 id=\"copy-the-demo-code\"><a href=\"#copy-the-demo-code\" aria-label=\"copy the demo code permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Copy the demo code</h3>\n<p><code class=\"language-text\">diffusion</code> is one of many installed demos in BioDynaMo. It can be copied out\nwith <code class=\"language-text\">biodynamo demo</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">biodynamo demo diffusion <span class=\"token keyword\">.</span></code></pre></div>\n<h3 id=\"inspect-the-code\"><a href=\"#inspect-the-code\" aria-label=\"inspect the code permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Inspect the code</h3>\n<p>Go into the <code class=\"language-text\">diffusion</code> directory and open the source file <code class=\"language-text\">src/diffusion.h</code> in your favorite editor.\nWe can note the following things from its content:</p>\n<h4 id=\"1-substance-list\"><a href=\"#1-substance-list\" aria-label=\"1 substance list permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Substance list</h4>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">enum</span> <span class=\"token class-name\">Substances</span> <span class=\"token punctuation\">{</span> kKalium <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The extracellular substances that will be used in the simulation are listed in\nan <code class=\"language-text\">enum</code> data structure. In this case it is just a single substance. According to our C++\ncoding style we will prepend the substance's name with the letter \"k\".</p>\n<h4 id=\"2-initial-model\"><a href=\"#2-initial-model\" aria-label=\"2 initial model permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Initial model</h4>\n<p>First, create a BioDynaMo simulation:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">Simulation <span class=\"token function\">simulation</span><span class=\"token punctuation\">(</span>argc<span class=\"token punctuation\">,</span> argv<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Next up is creating the initial model of our simulation.</p>\n<p>We start by defining the substance that cells may secreate</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">ModelInitializer<span class=\"token operator\">::</span><span class=\"token function\">DefineSubstance</span><span class=\"token punctuation\">(</span>kKalium<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Kalium\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">25</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">auto</span><span class=\"token operator\">*</span> rm <span class=\"token operator\">=</span> simulation<span class=\"token punctuation\">.</span><span class=\"token function\">GetResourceManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">auto</span><span class=\"token operator\">*</span> dgrid <span class=\"token operator\">=</span> rm<span class=\"token operator\">-></span><span class=\"token function\">GetDiffusionGrid</span><span class=\"token punctuation\">(</span>kKalium<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Next, we have to create an initial set of agents and set their\nattributes:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">  <span class=\"token keyword\">auto</span> construct <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">&amp;</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> Double3<span class=\"token operator\">&amp;</span> position<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    Cell<span class=\"token operator\">*</span> cell <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token function\">Cell</span><span class=\"token punctuation\">(</span>position<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    cell<span class=\"token operator\">-></span><span class=\"token function\">SetDiameter</span><span class=\"token punctuation\">(</span><span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    cell<span class=\"token operator\">-></span><span class=\"token function\">SetMass</span><span class=\"token punctuation\">(</span><span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    Double3 secretion_position <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span><span class=\"token number\">50</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>position <span class=\"token operator\">==</span> secretion_position<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      cell<span class=\"token operator\">-></span><span class=\"token function\">AddBehavior</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token function\">Secretion</span><span class=\"token punctuation\">(</span>dgrid<span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      cell<span class=\"token operator\">-></span><span class=\"token function\">AddBehavior</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token function\">Chemotaxis</span><span class=\"token punctuation\">(</span>dgrid<span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> cell<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  std<span class=\"token operator\">::</span>vector<span class=\"token operator\">&lt;</span>Double3<span class=\"token operator\">></span> positions<span class=\"token punctuation\">;</span>\n  positions<span class=\"token punctuation\">.</span><span class=\"token function\">push_back</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  positions<span class=\"token punctuation\">.</span><span class=\"token function\">push_back</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  positions<span class=\"token punctuation\">.</span><span class=\"token function\">push_back</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  positions<span class=\"token punctuation\">.</span><span class=\"token function\">push_back</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  positions<span class=\"token punctuation\">.</span><span class=\"token function\">push_back</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  positions<span class=\"token punctuation\">.</span><span class=\"token function\">push_back</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  positions<span class=\"token punctuation\">.</span><span class=\"token function\">push_back</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  positions<span class=\"token punctuation\">.</span><span class=\"token function\">push_back</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// The cell responsible for secretion</span>\n  positions<span class=\"token punctuation\">.</span><span class=\"token function\">push_back</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token number\">50</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  ModelInitializer<span class=\"token operator\">::</span><span class=\"token function\">CreateAgents</span><span class=\"token punctuation\">(</span>positions<span class=\"token punctuation\">,</span> construct<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The <code class=\"language-text\">construct</code> lambda defines the properties of each cell that we create. These can be\nphysical properties (diameter, mass), but also biological properties and behaviors\n(chemotaxis, substance secretion)</p>\n<p>This example uses the predefined behaviors <code class=\"language-text\">Chemotaxis</code> and <code class=\"language-text\">Secretion</code> that\nwill govern the behavior of the agents (i.e. cells).\nThese two behaviors are included in the BioDynaMo installation.</p>\n<p>One of the cells (the cell at position <code class=\"language-text\">{50, 50, 50}</code>) will be the one secreting the substance;\nit therefore gets assigned the <code class=\"language-text\">Secretion</code> behavior.\nAll other cells are assigned the <code class=\"language-text\">Chemotaxis</code> behavior.\nBasically it makes cells move according to the gradient,\ncaused by a concentration difference of the substance. </p>\n<p>Furthermore, we define the initial positions of the cells. In this example it is\ndone explicitly, but one could also generate a grid of cells, or a random distribution\nof cells.</p>\n<h3 id=\"simulation-parameters\"><a href=\"#simulation-parameters\" aria-label=\"simulation parameters permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Simulation Parameters</h3>\n<p>Create a <code class=\"language-text\">bdm.toml</code> file in the <code class=\"language-text\">diffusion</code> directory, and copy the following lines\ninto it:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[visualization]\nexport = true\ninterval = 10\n\n\t[[visualize_agent]]\n\tname = &quot;Cell&quot;\n\tadditional_data_members = [ &quot;diameter_&quot; ]\n\n\t[[visualize_diffusion]]\n\tname = &quot;Kalium&quot;\n\tgradient = true</code></pre></div>\n<p>This will enable exporting visualization files, so that we can visualize the\nsimulation after it has finished. Furthermore, we enable the output of the diameter\nof our agents (by default named \"Cell\"), and the gradient data of the\nextracellular diffusion</p>\n<h3 id=\"build-and-run-the-simulation\"><a href=\"#build-and-run-the-simulation\" aria-label=\"build and run the simulation permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Build and run the simulation</h3>\n<p>Run the following commands to build and run the simulation.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">biodynamo run</code></pre></div>\n<h3 id=\"visualize-the-simulation\"><a href=\"#visualize-the-simulation\" aria-label=\"visualize the simulation permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Visualize the simulation</h3>\n<p>Load the generated ParaView state file as described in <a href=\"/docs/userguide/visualization/#export-visualization-files\">Section Visualization</a>.</p>\n<p>From \"View\", select \"Animation Panel\". This will display some animation settings\nat the bottom of the screen. From the \"Mode\" select \"Real Time\".\nThen click the Play button at the top of the screen to run the simulation visualization.</p>\n<video width=\"100%\" controls>\n  <source src=\"https://cernbox.cern.ch/index.php/s/rzl2Kb4uxny4ZXF/download?path=%2F&files=exported_visualization.mp4\" type=\"video/mp4\">\n  Your browser does not support the video tag.\n</video>\n<h3 id=\"diffusion-parameter-constraints\"><a href=\"#diffusion-parameter-constraints\" aria-label=\"diffusion parameter constraints permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Diffusion parameter constraints</h3>\n<p>The differential equations that describe the diffusion are solved in an\nanalytical way using the central difference method as shown in the figure below:</p>\n<p><a href=\"/docs/userguide/diffusion/#diffusion-parameter-constraints\"><span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 28.355704697986578%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsSAAALEgHS3X78AAAAyElEQVQY02WPWw9EMBCF+/9/Fw+ExIsQIWqpS8UlCCUpe9Luym58D5PTac+ZDrm+CCGmaVoVTdPs+34cx7IsQiGlvB6QW+E1bDoiSZJxHHHs+x5+aAT92pC1bRt55sGTpuk8z7gehgFZ0IiWituM5sd8nuddMZwxpg16ER0Egc7ft7Fe27ZVVb0URVHkeQ6BWtd113UIiqKoLEto9OM4zrIMHUopcV3XsixU27bDMAyCwPM80zR933ccxzAMvOOcY3mYuQKTmOINgB5RwC67kgMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <picture>\n        <source\n          srcset=\"/static/d3e26f32f3bdde5985abf0b14ade39dd/50512/diffusion_central_difference_method.webp 163w,\n/static/d3e26f32f3bdde5985abf0b14ade39dd/aeba0/diffusion_central_difference_method.webp 325w,\n/static/d3e26f32f3bdde5985abf0b14ade39dd/001d9/diffusion_central_difference_method.webp 650w,\n/static/d3e26f32f3bdde5985abf0b14ade39dd/97fd0/diffusion_central_difference_method.webp 975w,\n/static/d3e26f32f3bdde5985abf0b14ade39dd/2acdf/diffusion_central_difference_method.webp 1192w\"\n          sizes=\"(max-width: 650px) 100vw, 650px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/d3e26f32f3bdde5985abf0b14ade39dd/19bd1/diffusion_central_difference_method.png 163w,\n/static/d3e26f32f3bdde5985abf0b14ade39dd/d3bcb/diffusion_central_difference_method.png 325w,\n/static/d3e26f32f3bdde5985abf0b14ade39dd/dbb61/diffusion_central_difference_method.png 650w,\n/static/d3e26f32f3bdde5985abf0b14ade39dd/6b691/diffusion_central_difference_method.png 975w,\n/static/d3e26f32f3bdde5985abf0b14ade39dd/ed46b/diffusion_central_difference_method.png 1192w\"\n          sizes=\"(max-width: 650px) 100vw, 650px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n          src=\"/static/d3e26f32f3bdde5985abf0b14ade39dd/dbb61/diffusion_central_difference_method.png\"\n          alt=\"Central Difference Method\"\n          title=\"\"\n        />\n      </picture>\n  </span></a></p>\n<p>The diffusion coefficient dictates the speed of diffusing a substance through\nspace, while with the decay constant one controls the speed at which a substance\ndecays. Mathematically, the method would allow for unphysical behavior to occur, such as\nnegative concentration values. In order to avoid such behavior from happening,\nwe impose the following constraint on the parameters:</p>\n<p><a href=\"/docs/userguide/diffusion/#diffusion-parameter-constraints\"><span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 132px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 66.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAABXklEQVQoz41STauCUBD1/69aVotwE0iuqk0tWgga4ialDzPEXuTXQw0hrJ6YvUMT16wevLPQuTNz5p65M9ytjuv1WpYlDPq+RwF25JhV1nH7B2pkfDebjeM4RVEcj8fn+8nY7/emabIjRz/P8yaTyXK57Pf7w+FwPB5Pp1PSyQTjq+u6KIowUL0in8/nRqMBQq/Xa7VazWYzjmPiUB6lQZQgCKwWx1QdDofL5TKfzy3L8n3/dDoxTpIkdIRh23bVM4WjKPq6IwxDML/vQAgcSZKgKMsypLmuy+pW5N1uN5vNDMNAV4vFYjQagQN/mqZoRNO0PM+RuV6v4YeTRHFMW7fbRVWaE65SVZX1tt1uiYAXRfXX14ZInudxM0rIsqwoymq1et+Zdrvd6XSCIHjcTLWRDS+Yg8EAb/ayYawE5GCQNIiHbAAt4SUxsJ87MJ7nNWSAH9EPG/a8SX/hJfoL1EPYdLfjx14AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <picture>\n        <source\n          srcset=\"/static/a7e4bc9aa1e64b83aa75a6b67bb57069/98c88/diffusion_parameters_constraint.webp 132w\"\n          sizes=\"(max-width: 132px) 100vw, 132px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/a7e4bc9aa1e64b83aa75a6b67bb57069/2e2d1/diffusion_parameters_constraint.png 132w\"\n          sizes=\"(max-width: 132px) 100vw, 132px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n          src=\"/static/a7e4bc9aa1e64b83aa75a6b67bb57069/2e2d1/diffusion_parameters_constraint.png\"\n          alt=\"Parameter Constraint\"\n          title=\"\"\n        />\n      </picture>\n  </span></a></p>\n<p>Since as a user, you are giving the resolution of the diffusion grid and not the\ndistance between the grid points, you can determine this value by dividing the\nlongest dimension of your space by the resolution, or by calling the corresponding\nfunction <code class=\"language-text\">DiffusionGrid::GetBoxLength()</code>.</p>\n<p>For more information on the inner workings of the diffusion behavior, please\nrefer to: <a href=\"https://repository.tudelft.nl/islandora/object/uuid%3A2fa2203b-ca26-4aa2-9861-1a4352391e09?collection=education\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://repository.tudelft.nl/islandora/object/uuid%3A2fa2203b-ca26-4aa2-9861-1a4352391e09?collection=education</a></p>\n<h3 id=\"runge-kutta-method\"><a href=\"#runge-kutta-method\" aria-label=\"runge kutta method permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Runge-Kutta method:</h3>\n<p>We have additionally implemented the 2nd order Runge-Kutta method within BioDynaMo.\nThe Runge-Kutta method is an iterative method for solving ordinary differential equations (ODEs), both implicitly and explicitly. Often outperforming the Euler method for complex ODEs.\nUnlike the Euler method which estimates the next time step based on the rate of change of the defined ODE at the current point, the Runge-Kutta method is a family of schemes which\ninvolve slope calculations between the current and next time step, with the number of slope estimates depending on the order of the Runge-Kutta method being utilised.</p>\n<p>In the case of the 2nd order Runge-Kutta method implemented here, a slope estimate is taken at the midpoint between the current and next time step, in addition to utilising the rate of change\nat the current time step.</p>\n<p>The Runge-Kutta method solves ODEs of the form:</p>\n<p><a href=\"/docs/userguide/diffusion/#runge_kutta_function\"><span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 164px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 37.19512195121951%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsSAAALEgHS3X78AAABPElEQVQY011QTU/CQBTs/z94IBy8GA9GDhhj0hCIJIIfiSYItVgES1ugBZZSusWllra73V23+Ilzmpmd9zZvJM45hNAwTUEopXwHxhj/i3/yG1IUompFLhQPu1oPY/KbZixN009FCM6yjFH6s104gksesM/K5Yosdwf550EQpJjo/d7EdubAJYQwimfTKYSBD6EwRWaD0MpzwcKVRFpRlEajMbFt31vU65eDoVGt1fRXfeUtLaN/fiGPx+NOu9VqPZqGIYZvmlfay8AyDYkyHr8jVX1ev4VJHJnWaO5YzbuHECGxW1VV5am7hr7W1x3bGVnmyBqKyRlYOI4j0Yzc314XCwdtTc+P5TyNI3fpCY7WwRwA4SRxgnF+drTdhmEonpJki0kmCtuUSqcnx0c28PMmRDH73bId9mv+kh+JZ4E6k9ToTQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <picture>\n        <source\n          srcset=\"/static/70186efdf028fdac5cfca2714c925f40/50512/runge_kutta_function.webp 163w,\n/static/70186efdf028fdac5cfca2714c925f40/876e8/runge_kutta_function.webp 164w\"\n          sizes=\"(max-width: 164px) 100vw, 164px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/70186efdf028fdac5cfca2714c925f40/19bd1/runge_kutta_function.png 163w,\n/static/70186efdf028fdac5cfca2714c925f40/63ea9/runge_kutta_function.png 164w\"\n          sizes=\"(max-width: 164px) 100vw, 164px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n          src=\"/static/70186efdf028fdac5cfca2714c925f40/63ea9/runge_kutta_function.png\"\n          alt=\"Runge-Kutta function\"\n          title=\"\"\n        />\n      </picture>\n  </span></a></p>\n<p>We estimate a solution explicitly using the following steps:</p>\n<p><a href=\"/docs/userguide/diffusion/#runge_kutta_equation\"><span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 56.67613636363637%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABOklEQVQoz3VS7XKDIBDk/R8xxYgKKKDg+BURJnbFacc06f7AQ+5udw/IM2Hf9xhCyYqqqoqi+KL0drsxxu73jBUFpRQxF0JrHULcf0D2T1jXB/Jsd8BaO8/zew4oSVPXSuu2bZVSHVatjTEikRijBRd1XbcJJgGBc24YBik4Qe/jpGtV04AKp6DqUq7tEIDZ9b07WndnfTskCBS/6/F+HcdRKwXqYRyss0YbsJ1Sr5nk+YLj17Zty/KY5nnBJwHBlGx7788WJ8ive6yQiSHneV5WPMtozljFOQZeN83hXwqIvvKTPwOMMfqEdV1DjNA/TdOSAEVQ8SL73TMKMCoMBz6llBi7lMJ+9HzdhBBwSXgnmC3K4EJrhavC1lkLzX7b/i1GY4jENXHOKc3QRQhZliXivu/xVGDqmv8Ntap0On0I+IMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <picture>\n        <source\n          srcset=\"/static/123bf0090cc88cdd2ffec4561a32a1a7/50512/runge_kutta_equation.webp 163w,\n/static/123bf0090cc88cdd2ffec4561a32a1a7/aeba0/runge_kutta_equation.webp 325w,\n/static/123bf0090cc88cdd2ffec4561a32a1a7/001d9/runge_kutta_equation.webp 650w,\n/static/123bf0090cc88cdd2ffec4561a32a1a7/a2f5a/runge_kutta_equation.webp 704w\"\n          sizes=\"(max-width: 650px) 100vw, 650px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/123bf0090cc88cdd2ffec4561a32a1a7/19bd1/runge_kutta_equation.png 163w,\n/static/123bf0090cc88cdd2ffec4561a32a1a7/d3bcb/runge_kutta_equation.png 325w,\n/static/123bf0090cc88cdd2ffec4561a32a1a7/dbb61/runge_kutta_equation.png 650w,\n/static/123bf0090cc88cdd2ffec4561a32a1a7/ad9ce/runge_kutta_equation.png 704w\"\n          sizes=\"(max-width: 650px) 100vw, 650px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n          src=\"/static/123bf0090cc88cdd2ffec4561a32a1a7/dbb61/runge_kutta_equation.png\"\n          alt=\"Runge-Kutta equation\"\n          title=\"\"\n        />\n      </picture>\n  </span></a></p>\n<p>Here k1 is the slope at the beginning of the interval and k2 is the slope at the midpoint of the interval. With h determining interval length being solved for.</p>\n<p>For example, with a h value of 1, we would be estimating between the current time step t to t+1 with a single midpoint slope estimate. For most ODEs\nincreasing the number of intervals to be taken per time step increases overall accuracy, as we will be taking a greater number of midpoint slope estimates between t to t+1.</p>\n<p>So, if we instead set h = 0.5, the method will first estimate over t to t + 0.5 with a midpoint slope estimate, repeating this for t + 0.5 to t + 1 with a second midpoint slope estimate.\nHowever, there is a trade-off taken here with increased computational time for increasing accuracy.</p>\n<p>As stated, the higher order Runge-Kutta methods often outperform lower order solvers for ODEs, however this does not happen for the currently implemented version of chemical diffusion.\nThis is due to the fact that when one breaks down the partial differential equations (PDEs) that define chemical diffusion into the set of ODEs that define equation 3.1,\nthe time dependant variable is lost on the right hand side of the equation.\nThis results in the extra steps being taken for the Runge-Kutta method having minimal impact as there is no time dependant variable to estimate the slope from.</p>\n<p>Within BioDynaMo the number of intervals for the Runge-Kutta method to iterate over per time step can be set within the declaration of a diffusion grid itself as follows:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">DiffusionGrid* dgrid = new DiffusionGrid(substance_id, &quot;substance_name&quot;, diffusion_coefficient,\n                decay_constant, resolution, diffusion_step)\n                </code></pre></div>\n<p>Note: </p>\n<ul>\n<li>The entered value for the diffusion_step is required to be a positive integer value of greater than 0.</li>\n</ul>\n<p>To access the Runge-Kutta method for diffusion, one simply needs to update the bdm.toml file as follows :</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[simulation]\ndiffusion_type = &quot;RK&quot;\n\n[visualization]\nexport = true\ninterval = 10\ndiffusion_type = &quot;RK&quot;\n\n\t[[visualize_agent]]\n\tname = &quot;Cell&quot;\n\tadditional_data_members = [ &quot;diameter_&quot; ]\n\n\t[[visualize_diffusion]]\n\tname = &quot;Kalium&quot;\n\tgradient = true</code></pre></div>\n<p>Note:</p>\n<ul>\n<li>This method requires the input of known initial boundary conditions for the ODE being solved.</li>\n<li>This method is also commonly referred to as the midpoint method or improved Euler.\t</li>\n<li>This method can additionally be used to solve partial differential equations (PDEs) but requires each component to be individually broken down into separate ODEs.</li>\n</ul>","fields":{"slug":"/docs/userguide/diffusion/"},"timeToRead":7,"excerpt":"One of BioDynaMo's built-in biological processes is extracellular diffusion.\nIt is the process of extracellular substances diffusing throughâ€¦","fileAbsolutePath":"/website/content/biodynamo/doc/user_guide/diffusion.md"}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/docs/userguide/diffusion/"}}}