{"componentChunkName":"component---src-templates-markdown-post-js","path":"/docs/userguide/operation/","webpackCompilationHash":"3ec924261af6cb506578","result":{"data":{"site":{"siteMetadata":{"siteUrl":"http://local:8000","title":"BioDynaMO Website","description":"Everything you need to know about biology simulations."}},"markdownRemark":{"frontmatter":{"title":"Operation","date":"2019-01-01","date_pretty":"01 January, 2019","path":"/docs/userguide/operation/","meta_title":"BioDynaMo User Guide","meta_description":"This is the operation page.","image":"","next":{"url":"/docs/userguide/operation/","title":"Operation","description":"This is the operation page."},"sidebar":"userguide","toc":true},"html":"<p>Operations are functions that are executed at a given frequency throughout the simulation.\nTo execute a function for <em>specific</em> agents have a look at behaviors.\n<strong>An operation can have multiple implementations.</strong>\nEach implementation can target a different type of hardware (e.g. CPU or GPU) as shown in the following image:</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/503b59ae69cbbd6213e8f7056c8d1228/a987b/operation.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 59.166666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAACjvAAAo7wEenTBzAAABy0lEQVQoz5VT16oiQRSc//8CX0yoDwoqmHPOYs6KCUREUMxioi51Ln25Dwu7O1Cc7p7qOsWZGs3lciGfz6NYLKJUKqFcLiOVSsm+Vquh2+3+FZ1OB8PhELlcDlqv10MgEIDFYoHX60UoFILH4wEbTadT/M9zOp2gtVotzGYz6bJcLtHv92XNzuw6GAzweDzw+Xzwfr//iNfrJYLb7RZau93GaDRCs9nEZDLBfD7HarXC/X7H8/kU/Ouz3++/Hd5uN+x2OxwOB8HlchFB1uPxiOv1Ki7O57OcqUrwHffk04iWSCRgNBqh1+thNpsFBoMBOp0ObrdbZhqLxdBoNIRns9lgt9sFVqsVJpNJzhwOB5xOJ7R4PA6K8lIymUQmk0E2mxVwHBxBpVJBvV5HMBiEz+dDOByWdSQSQTQalbuFQkGaiyBf8AsrImNDsWq1KmCsOGNeIJcglzEjj+5ZmQ4RZAeKsBvdqspzVrrmrCnId0qQlRzFY9Q0EihK0HY6nZbLzOB4PJYvTycMOS+xMcPPJnSveIye3++HxllRlB3ZSbnjRYJrClKYDtXMlQnOnSCX49K42Gw2WCwWEmwF7hUYh/V6/cP5XQmVXf4MXwBTO85fbJnuAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <picture>\n        <source\n          srcset=\"/static/503b59ae69cbbd6213e8f7056c8d1228/50512/operation.webp 163w,\n/static/503b59ae69cbbd6213e8f7056c8d1228/aeba0/operation.webp 325w,\n/static/503b59ae69cbbd6213e8f7056c8d1228/001d9/operation.webp 650w,\n/static/503b59ae69cbbd6213e8f7056c8d1228/97fd0/operation.webp 975w,\n/static/503b59ae69cbbd6213e8f7056c8d1228/05607/operation.webp 1300w,\n/static/503b59ae69cbbd6213e8f7056c8d1228/34ef4/operation.webp 1920w\"\n          sizes=\"(max-width: 650px) 100vw, 650px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/503b59ae69cbbd6213e8f7056c8d1228/19bd1/operation.png 163w,\n/static/503b59ae69cbbd6213e8f7056c8d1228/d3bcb/operation.png 325w,\n/static/503b59ae69cbbd6213e8f7056c8d1228/dbb61/operation.png 650w,\n/static/503b59ae69cbbd6213e8f7056c8d1228/6b691/operation.png 975w,\n/static/503b59ae69cbbd6213e8f7056c8d1228/91670/operation.png 1300w,\n/static/503b59ae69cbbd6213e8f7056c8d1228/a987b/operation.png 1920w\"\n          sizes=\"(max-width: 650px) 100vw, 650px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n          src=\"/static/503b59ae69cbbd6213e8f7056c8d1228/dbb61/operation.png\"\n          alt=\"Operations\"\n          title=\"\"\n        />\n      </picture>\n  </span>\n  </a></p>\n<p>This example shows an overview of the displacement operation; one of the default operations in BioDynaMo.\nThis operation is implemented for different computing targets, of which two are shown in the image above.\nThe <code class=\"language-text\">MechanicalForcesOp</code> implementation targets execution on CPUs, whereas <code class=\"language-text\">MechanicalForcesOpCuda</code> targets execution on GPUs using the CUDA framework.\nAs a user, you can develop new <em>operation implementations</em> and append them to an <em>operation</em> with a specific name.\nThe BioDynaMo core will be able to select the right implementation based on your system (i.e. having a GPU or not).</p>\n<p>An operation operates at a certain frequency, which can be set after <em>registering</em> the operation.</p>\n<h2 id=\"operation-implementation-types\"><a href=\"#operation-implementation-types\" aria-label=\"operation implementation types permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Operation implementation types</h2>\n<p>There are two types of operation implementations:</p>\n<ol>\n<li><code class=\"language-text\">AgentOperationImpl</code>: executed for each agent at the given frequency</li>\n<li><code class=\"language-text\">StandaloneOperationImpl</code>: executed once at the given frequency</li>\n</ol>\n<p><code class=\"language-text\">AgentOperationImpl</code> is used for operation implementations that will be executed for all agents. The displacement operation in BioDynaMo is such a type of operation: for every agent we calculate the displacement force if there is a collision with other agents.\n<code class=\"language-text\">StandaloneOperationImpl</code> is used for operations that will be executed once at the operation's given frequency. The diffusion operation is such a type of operation: it is independent of how many agents there are.\nThe displacement operation implementation for GPUs is also a <code class=\"language-text\">StandaloneOperationImpl</code> type, because the GPU implementation will not need to be executed for each agent.</p>\n<p>Both implementation types have a <code class=\"language-text\">SetUp()</code> and <code class=\"language-text\">TearDown()</code> method. These methods are, respectively, executed before and after the operation is executed.\nFor GPU operations these can be used to copy data between the GPU and CPU.</p>\n<h2 id=\"registering-an-operation\"><a href=\"#registering-an-operation\" aria-label=\"registering an operation permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Registering an operation</h2>\n<p>Operations are stored in the <code class=\"language-text\">OperationRegistry</code> in BioDynaMo.\nAny new operation implementation that you wish to add to BioDynaMo needs to be registered before it can be used.\nLet's use the displacement operation as an example to see how this works.</p>\n<p>First, create two files: a header file (.h) and an implementation file (.cc).\nThe header file contains the logic of your operation, whereas the implementation file registers the operation.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// File: mechanical_forces_op.h (minimal version)</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">MechanicalForcesOp</span> <span class=\"token operator\">:</span> <span class=\"token keyword\">public</span> AgentOperationImpl <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// This macro will generate the boilerplate code. It must be included.</span>\n  <span class=\"token function\">BDM_OP_HEADER</span><span class=\"token punctuation\">(</span>MechanicalForcesOp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Here you define you operation's logic. The `agent` pointer is a handle</span>\n  <span class=\"token comment\">// to each agent in your simulation</span>\n  <span class=\"token keyword\">void</span> <span class=\"token keyword\">operator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>Agent<span class=\"token operator\">*</span> agent<span class=\"token punctuation\">)</span> override <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// In the displacement operation we check the environment of `agent`,</span>\n    <span class=\"token comment\">// and apply a displacement force if there is a collision</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// File: mechanical_forces_op.cc (minimal version)</span>\n\n<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">\"core/operation/operation.h\"</span></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">\"core/operation/mechanical_forces_op.h\"</span></span>\n\n<span class=\"token comment\">// This registers our MechanicalForcesOp in the OperationRegistry under </span>\n<span class=\"token comment\">// the name \"mechanical forces\". Since this operation is targeted to run </span>\n<span class=\"token comment\">// on a CPU, we specify \"kCpu\"</span>\n<span class=\"token function\">BDM_REGISTER_OP</span><span class=\"token punctuation\">(</span>MechanicalForcesOp<span class=\"token punctuation\">,</span> <span class=\"token string\">\"mechanical forces\"</span><span class=\"token punctuation\">,</span> kCpu<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>With the above two files you will be able to successfully add the operation implementation\n<code class=\"language-text\">MechanicalForcesOp</code> to the operation named \"mechanical forces\".\nThis operation is now accessible in your simulation code as we will see below.\nBy default, any operation is executed once every timestep (i.e. the frequency is 1).</p>\n<p>Here the link for the complete API documentation for <a href=\"/bioapi/structbdm_1_1Operation.html\">Operation</a></p>\n<h2 id=\"usage-example\"><a href=\"#usage-example\" aria-label=\"usage example permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Usage example</h2>\n<p>Once an operation operation is registered, using it for a simulation is done as follows.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">Simulation <span class=\"token function\">simulation</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"my-sim\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">auto</span><span class=\"token operator\">*</span> scheduler <span class=\"token operator\">=</span> simulation<span class=\"token punctuation\">.</span><span class=\"token function\">GetScheduler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Get the operation by its registered name</span>\n<span class=\"token keyword\">auto</span><span class=\"token operator\">*</span> mechanical_forces_op <span class=\"token operator\">=</span> <span class=\"token function\">NewOperation</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mechanical forces\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Change the frequency to the desired number</span>\n<span class=\"token comment\">// 1 is the default, so we could have skipped this step</span>\nmechanical_forces_op<span class=\"token operator\">-></span>frequency_ <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Schedule the operation for execution</span>\nscheduler<span class=\"token operator\">-></span><span class=\"token function\">ScheduleOp</span><span class=\"token punctuation\">(</span>mechanical_forces_op<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Simulate for 10 timesteps. The displacement operation will be </span>\n<span class=\"token comment\">// executed every timestep, because the frequency is 1</span>\nsimulation<span class=\"token punctuation\">.</span><span class=\"token function\">Simulate</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Once you schedule your operation with <code class=\"language-text\">Scheduler::ScheduleOp</code> you are not longer responsible for the memory management; the <code class=\"language-text\">Scheduler</code> will take care of that.\nIf you do not schedule your operation, you should free the created operation to avoid memory leaks. In the above example it would be <code class=\"language-text\">delete mechanical_forces_op</code>.</p>\n<h2 id=\"schedule-multiple-operations-with-the-same-name\"><a href=\"#schedule-multiple-operations-with-the-same-name\" aria-label=\"schedule multiple operations with the same name permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Schedule multiple operations with the same name</h2>\n<p>There are cases in which you might want to schedule multiple instances of a single operation, each with a slightly different logic.\nAn example could be to query how many agents there are with a certain diameter. For example: how many agents are there with a diameter greater than 10, and how many agents are there with a diameter greater than 20.\nYou could approach this the following way.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// File: check_diameter.h</span>\n\n<span class=\"token comment\">// Create an operation implementation with a state</span>\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">CheckDiameter</span> <span class=\"token operator\">:</span> <span class=\"token keyword\">public</span> AgentOperationImpl <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">BDM_OP_HEADER</span><span class=\"token punctuation\">(</span>CheckDiameter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">CheckDiameter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Since atomic members don't have a deleted copy constructor, we have to</span>\n  <span class=\"token comment\">// define how to copy its value in this operation's copy constructor</span>\n  <span class=\"token keyword\">explicit</span> <span class=\"token function\">CheckDiameter</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> CheckDiameter<span class=\"token operator\">&amp;</span> other<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token operator\">-></span>counter_ <span class=\"token operator\">=</span> other<span class=\"token punctuation\">.</span>counter_<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">void</span> <span class=\"token keyword\">operator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>Agent<span class=\"token operator\">*</span> agent<span class=\"token punctuation\">)</span> override <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>agent<span class=\"token operator\">-></span><span class=\"token function\">GetDiameter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> max_diameter_<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      counter_<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// The state consists of these two data members</span>\n  <span class=\"token keyword\">double</span> max_diameter_ <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// Data members that can be changed in `operator()(Agent*</span>\n  <span class=\"token comment\">// agent)` need to be of atomic type to avoid race conditions</span>\n  std<span class=\"token operator\">::</span>atomic<span class=\"token operator\">&lt;</span><span class=\"token keyword\">uint32_t</span><span class=\"token operator\">></span> counter_<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// File: check_diameter.cc</span>\n\n<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">\"core/operation/operation.h\"</span></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">\"check_diameter.h\"</span></span>\n\n<span class=\"token function\">BDM_REGISTER_OP</span><span class=\"token punctuation\">(</span>CheckDiameter<span class=\"token punctuation\">,</span> <span class=\"token string\">\"check_diameter\"</span><span class=\"token punctuation\">,</span> kCpu<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">Simulation <span class=\"token function\">simulation</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test_sim\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">auto</span><span class=\"token operator\">*</span> scheduler <span class=\"token operator\">=</span> simulation<span class=\"token punctuation\">.</span><span class=\"token function\">GetScheduler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// We instantiate two \"check_diameter\" operations</span>\n<span class=\"token keyword\">auto</span><span class=\"token operator\">*</span> check_diameter10 <span class=\"token operator\">=</span> <span class=\"token function\">NewOperation</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"check_diameter\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">auto</span><span class=\"token operator\">*</span> check_diameter20 <span class=\"token operator\">=</span> <span class=\"token function\">NewOperation</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"check_diameter\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Change the threshold values of each instantiation</span>\n<span class=\"token comment\">// We have to specify the type of the operation implementation `CheckDiameter`</span>\ncheck_diameter10<span class=\"token operator\">-></span>GetImplementation<span class=\"token operator\">&lt;</span>CheckDiameter<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>max_diameter_ <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\ncheck_diameter20<span class=\"token operator\">-></span>GetImplementation<span class=\"token operator\">&lt;</span>CheckDiameter<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>max_diameter_ <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Schedule both of them</span>\nscheduler<span class=\"token operator\">-></span><span class=\"token function\">ScheduleOp</span><span class=\"token punctuation\">(</span>check_diameter10<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nscheduler<span class=\"token operator\">-></span><span class=\"token function\">ScheduleOp</span><span class=\"token punctuation\">(</span>check_diameter20<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Now your simulation will run both operations at each timestep</span>\nsimulation<span class=\"token punctuation\">.</span><span class=\"token function\">Simulate</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Since an <code class=\"language-text\">Operation</code> can have multiple implementations (<code class=\"language-text\">OperationImpl</code>), we need to specify which of the implementations we are targeting with <code class=\"language-text\">GetImplementation&lt;T&gt;()</code>, where <code class=\"language-text\">T</code> is the type of your operation implementation.</p>\n<h2 id=\"unschedule-an-operation\"><a href=\"#unschedule-an-operation\" aria-label=\"unschedule an operation permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Unschedule an operation</h2>\n<p>If you wish to unschedule an operation from a simulation, you can do that in the\nfollowing way (we reuse the <code class=\"language-text\">CheckDiameter</code> operation from before):</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">Simulation <span class=\"token function\">simulation</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test_sim\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">auto</span><span class=\"token operator\">*</span> scheduler <span class=\"token operator\">=</span> simulation<span class=\"token punctuation\">.</span><span class=\"token function\">GetScheduler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">auto</span><span class=\"token operator\">*</span> check_diameter <span class=\"token operator\">=</span> <span class=\"token function\">NewOperation</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"check_diameter\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nscheduler<span class=\"token operator\">-></span><span class=\"token function\">ScheduleOp</span><span class=\"token punctuation\">(</span>check_diameter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Your simulation will run CheckDiameter at each timestep</span>\nsimulation<span class=\"token punctuation\">.</span><span class=\"token function\">Simulate</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Unschedule the CheckDiameter operation</span>\nscheduler<span class=\"token operator\">-></span><span class=\"token function\">UnscheduleOp</span><span class=\"token punctuation\">(</span>check_diameter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Your simulation will not run CheckDiameter anymore</span>\nsimulation<span class=\"token punctuation\">.</span><span class=\"token function\">Simulate</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"get-operations\"><a href=\"#get-operations\" aria-label=\"get operations permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Get operations</h2>\n<p>The scheduler of BioDynaMo runs a list of all operations that have\nbeen added either by default or by calling <code class=\"language-text\">Scheduler::ScheduleOp(op)</code>.\nA pointer to these operations can be retrieved by calling: <code class=\"language-text\">Scheduler::GetOps(name)</code>.\nThis function returns a vector of operation pointers with operations that match\nthe given name.\nIf the given operation name is a protected operation the returned vector will be empty.\nA default (non protected) operation can be unscheduled in the following way:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">Simulation <span class=\"token function\">simulation</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test_sim\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">auto</span><span class=\"token operator\">*</span> scheduler <span class=\"token operator\">=</span> simulation<span class=\"token punctuation\">.</span><span class=\"token function\">GetScheduler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">auto</span> ops <span class=\"token operator\">=</span> scheduler<span class=\"token operator\">-></span><span class=\"token function\">GetOps</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mechanical forces\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nscheduler<span class=\"token operator\">-></span><span class=\"token function\">UnscheduleOp</span><span class=\"token punctuation\">(</span>ops<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Your simulation will not run the displacement operation</span>\nsimulation<span class=\"token punctuation\">.</span><span class=\"token function\">Simulate</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>","fields":{"slug":"/docs/userguide/operation/"},"timeToRead":6,"excerpt":"Operations are functions that are executed at a given frequency throughout the simulation.\nTo execute a function for specific agents have a…","fileAbsolutePath":"/website/content/biodynamo/doc/user_guide/operation.md"}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/docs/userguide/operation/"}}}