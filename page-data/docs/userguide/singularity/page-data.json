{
    "componentChunkName": "component---src-templates-markdown-post-js",
    "path": "/docs/userguide/singularity/",
    "result": {"data":{"site":{"siteMetadata":{"siteUrl":"http://local:8000","title":"BioDynaMo Website","description":"Everything you need to know about agent-based simulations."}},"markdownRemark":{"frontmatter":{"title":"Singularity","date":"2022-02-15","date_pretty":"15 February, 2022","path":"/docs/userguide/singularity/","meta_title":"BioDynaMo User Guide","meta_description":"This is the singularity page.","image":"","next":{"url":"/docs/userguide/singularity/","title":"Singularity","description":"This is the diffusion page."},"sidebar":"userguide","toc":true},"html":"<p>In addition to running BioDynaMo on standard computers, users can also utilise the BioDynaMo frame work on high\nperformance computers (HPCs). Due to many HPCs having higher security than standard computers however it is likely\nthat a user wishing to do this will need to build BioDynaMo within a container on the chosen HPC.</p>\n<p>For this we have chosen to Singularity. Singularity is an open source programme for operating-system-level virtualization.\nSingularity works similar to other popular container programmes such as Docker. However, due to its higher level of\nsecurity it has seen more widespread uptake by HPCs and we thus believe the best choice for users.</p>\n<p>To create our <a href=\"https://github.com/BioDynaMo/biodynamo/blob/master/Singularity\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">singularity image</a>\nfor BioDynaMo we can use on of two methods.</p>\n<h2 id=\"method-1-directly-building-on-the-hpc\" style=\"position:relative;\"><a href=\"#method-1-directly-building-on-the-hpc\" aria-label=\"method 1 directly building on the hpc permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Method 1, directly building on the HPC.</h2>\n<p>For the first method, we directly import the biodynamo Singularity file from our local PC to the desired HPC as follows.<br>\nFirstly, we must scp into the desired HPC from our local PC. This can be done directly through the terminal as follows.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">ssh</span> -x <span class=\"token punctuation\">[</span>HPC.ADDRESS<span class=\"token punctuation\">]</span></code></pre></div>\n<p>We then must secure copy the BioDynaMo singularity file from the chosen PC to the local HPC.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">scp</span> <span class=\"token punctuation\">[</span>user@<span class=\"token punctuation\">]</span>SRC_LOCALPC/SingularityFileLocation:<span class=\"token punctuation\">]</span>Singularity ~/</code></pre></div>\n<p>From here we can build BioDynaMo utilising the fake root feature of singularity. </p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">singularity build --fakeroot Singularity.sif Singularity</code></pre></div>\n<p>Fakeroot is not needed if you have sudo rights on the HPC but this is highly unlikely for most individuals.\nIn that case however we simply amend the above to:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> singularity build Singularity.sif Singularity</code></pre></div>\n<p>Then simply run the BioDynaMo singularity container using:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">singularity run --cleanenv Singularity.sif</code></pre></div>\n<p>where the <code class=\"language-text\">--cleanenv</code> option clears out all the environment variables set in the host machine to avoid conflicts.</p>\n<p>Once the container is running we can source Root and the BioDynaMo environment:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">source</span> /biodynamo/build/third_party/root/bin/thisroot.sh</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">source</span> /biodynamo/build/bin/thisbdm.sh</code></pre></div>\n<h2 id=\"method-2-export-image-from-local-pc-to-hpc\" style=\"position:relative;\"><a href=\"#method-2-export-image-from-local-pc-to-hpc\" aria-label=\"method 2 export image from local pc to hpc permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Method 2, Export image from local PC to HPC.</h2>\n<p>If you cannot utilise either sudo or fakeroot on the HPC, we can instead build the BioDynaMo image on our local PC and export the image.\nThis works similar to method 1 but with a change in order. Firstly, we must build our image on the local PC with sudo rights:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> singularity build Singularity.sif Singularity</code></pre></div>\n<p>Then ssh into the HPC.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">ssh</span> -x <span class=\"token punctuation\">[</span>HPC.ADDRESS<span class=\"token punctuation\">]</span></code></pre></div>\n<p>secure copy the image from our PC to the local HPC.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">scp</span> <span class=\"token punctuation\">[</span>user@<span class=\"token punctuation\">]</span>SRC_LOCALPC/SingularityFileLocation:<span class=\"token punctuation\">]</span>Singularity.sif ~/</code></pre></div>\n<p>Finally we once again run the Singularity image on the HPC:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">singularity run --cleanenv Singularity.sif</code></pre></div>\n<p>where the <code class=\"language-text\">--cleanenv</code> option clears out all the environment variables set in the host machine to avoid conflicts.</p>\n<p>Once the container is running we can source Root and the BioDynaMo environment:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">source</span> /biodynamo/build/third_party/root/bin/thisroot.sh</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">source</span> /biodynamo/build/bin/thisbdm.sh</code></pre></div>\n<p>If you wish to read further about Singularity, you can find a substantial amount of information on the\nsingularity home website: <a href=\"https://sylabs.io/guides/3.5/user-guide/introduction.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://sylabs.io/guides/3.5/user-guide/introduction.html</a>. Including many tutorials and more\ncomplex use cases.</p>\n<h2 id=\"exporting-visualisations-on-hpcs\" style=\"position:relative;\"><a href=\"#exporting-visualisations-on-hpcs\" aria-label=\"exporting visualisations on hpcs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Exporting visualisations on HPC's</h2>\n<p>By default, BioDynaMo uses ParaView for visualization, which needs an X-display server to function. Since the Singularity image does not provide a graphical desktop environment and hence no X-server, there are two workarounds.</p>\n<h3 id=\"option-1-using-xvfb\" style=\"position:relative;\"><a href=\"#option-1-using-xvfb\" aria-label=\"option 1 using xvfb permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Option 1: Using xvfb</h3>\n<p><code class=\"language-text\">xvfb</code> stands for X virtual frame buffer and emulates the required display server. Start a virtual frame buffer with: </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">/biodynamo/util/xvfb-initd.sh start</code></pre></div>\n<p>The buffer can be managed with the arguments <code class=\"language-text\">start</code>|<code class=\"language-text\">stop</code>|<code class=\"language-text\">restart</code></p>\n<p>Note: Some systems may require display forwarding <strong>before</strong> starting the frame buffer. This can be achived through <code class=\"language-text\">export DISPLAY=0</code>.</p>\n<h3 id=\"option-2-setting-paraview-to-work-in-a-headless-mode-using-the-cmake-flag\" style=\"position:relative;\"><a href=\"#option-2-setting-paraview-to-work-in-a-headless-mode-using-the-cmake-flag\" aria-label=\"option 2 setting paraview to work in a headless mode using the cmake flag permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Option 2: Setting Paraview to work in a headless mode using the CMAKE flag</h3>\n<p>Paraview with the osmesa or EGL backend does not require an X-server. To change the backend, you have to edit the cmake options in [1], build paraview, and replace the ParaView version that BioDynaMo installs. See also [2].</p>\n<p>[1] <a href=\"https://github.com/BioDynaMo/biodynamo/blob/HPC-documentation/util/build-third-party/paraview/build.sh\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/BioDynaMo/biodynamo/blob/HPC-documentation/util/build-third-party/paraview/build.sh</a></p>\n<p>[2] <a href=\"https://discourse.paraview.org/t/pvpython-offscreen-rendering-segfault/246/3\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://discourse.paraview.org/t/pvpython-offscreen-rendering-segfault/246/3</a></p>","fields":{"slug":"/docs/userguide/singularity/"},"timeToRead":4,"excerpt":"In addition to running BioDynaMo on standard computers, users can also utilise the BioDynaMo frame work on high \nperformance computers (HPCsâ€¦","fileAbsolutePath":"/website/content/biodynamo/doc/user_guide/Singularity.md"}},"pageContext":{"slug":"/docs/userguide/singularity/"}},
    "staticQueryHashes": []}